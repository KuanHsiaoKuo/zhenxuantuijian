# -*- coding: utf-8 -*-

# Define your item pipelines here
#
# Don't forget to add your pipeline to the ITEM_PIPELINES setting
# See: http://doc.scrapy.org/en/latest/topics/item-pipeline.html
import MySQLdb
import pdb

# 定义基本的数据库信息
dbuser = 'root'
dbpass = '123456'
dbname = 'blogdb'
dbhost = '127.0.0.1'
dbport = '3306'


# 管道名字可以任意命名，要和settings中的一致
class MySQLStorePipeline(object):
    # 写连接数据库的初始化方法
    def __init__(self):
        self.conn = MySQLdb.connect(
            user=dbuser, passwd=dbpass, db=dbname, host=dbhost, charset='utf8')
        self.cursor = self.conn.cursor()

    def process_item(self, item, spider):
        try:
            # pdb.set_trace()
            self.cursor.execute(
                """
                insert into blog_article 
                select max(id) +1,
                '%s','%s','%s',%s,%s,'%s',%s,%s
                from blog_article
                """,
                (
                    '\xe6\xac\xa2\xe8\xbf\x8e\xe5\x8a\xa0\xe5\x85\xa5\xe7\x99\xbd\xe8\x8f\x9c\xe5\x93',
                    '\xe6\x8b\x9b\xe8\x81\x98\xe9\x95...',
                    '\xe7\x99\xbd\xe8\x8f\x9c\xe5\x93\xa62011\xe5\xb9\xb412\xe6\x9c\x88\xe5\xbb\xba\xe7\xab\x99\xef\xbc\x8c\xe9\xa3\x8e\xe9\xa3\x8e\xe9\x9b\xa8\xe9\x9b\xa8\xe4\xb8\x80\xe8\xb7\xaf\xe8\xb5\xb0\xe6\x9d\xa5\xef\xbc\x8c\xe5\xb7\xb2\xe7\xbb\x8f\xe5\xbf\xab3\xe5\xb9\xb4\xe4\xba\x86\xef\xbc\x8c\xe9\xa6\x96\xe5\x85\x88\xe8\xa6\x81\xe6\x84\x9f\xe8\xb0\xa2\xe7\x9a\x84\xe5\xb0\xb1\xe6\x98\xaf\xe5\x8f\xaf\xe7\x88\xb1\xe7\x9a\x84\xe8\x8f\x9c\xe6\xb2\xb9\xe4\xbb\xac\xef\xbc\x8c\xe6\x98\xaf\xe4\xbd\xa0\xe4\xbb\xac\xe4\xb8\x8d\xe7\xa6\xbb\xe4\xb8\x8d\xe5\xbc\x83\xe7\x9a\x84\xe9\x99\xaa\xe4\xbc\xb4\xef\xbc\x8c\xe6\x89\x8d\xe8\xae\xa9\xe8\x80\x81\xe7\x99\xbd\xe5\x9d\x9a\xe6\x8c\x81\xe8\x87\xb3\xe4\xbb\x8a\xef\xbc\x8c\xe6\xb2\xa1\xe6\x9c\x89\xe5\x85\xb6\xe4\xbb\x96\xe6\x96\xb9\xe5\xbc\x8f\xe5\x8f\xaf\xe4\xbb\xa5\xe8\xa1\xa8\xe7\xa4\xba\xe6\x88\x91\xe4\xbb\xac\xe7\x9a\x84\xe6\x84\x9f\xe6\xbf\x80\xef\xbc\x8c\xe6\x88\x91\xe4\xbb\xac\xe5\x8f\xaa\xe8\x83\xbd\xe9\x9d\xa0\xe6\x9b\xb4\xe5\x8a\xaa\xe5\x8a\x9b\xe7\x9a\x84\xe5\xb7\xa5\xe4\xbd\x9c\xef\xbc\x8c\xe5\x8f\x91\xe6\x8e\x98\xe6\x9b\xb4\xe5\xa4\x9a\xe6\x9c\x89\xe4\xbb\xb7\xe5\x80\xbc\xe7\x9a\x84\xe4\xbf\xa1\xe6\x81\xaf',
                    '16',
                    '0',
                    '2014-09-23 21:48',
                    '2',
                    '2'
                )
            )
            self.conn.commit()
        except MySQLdb.Error as e:
            print "Error %d: %s" % (e.args[0], e.args[1])
        return item
